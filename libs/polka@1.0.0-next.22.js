var __commonJS=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),__require=t=>import.meta.require(t),require_regexparam=__commonJS((t,e)=>{e.exports=function(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var r,s,i,n,a=[],h="",u=t.split("/");for(u[0]||u.shift();i=u.shift();)"*"===(r=i[0])?(a.push("wild"),h+="/(.*)"):":"===r?(s=i.indexOf("?",1),n=i.indexOf(".",1),a.push(i.substring(1,~s?s:~n?n:i.length)),h+=~s&&!~n?"(?:/([^/]+?))?":"/([^/]+?)",~n&&(h+=(~s?"?":"")+"\\"+i.substring(n))):h+="/"+i;return{keys:a,pattern:RegExp("^"+h+(e?"(?=$|/)":"/?$"),"i")}}}),require_trouter=__commonJS((t,e)=>{var r=require_regexparam(),s={"":0,GET:1,HEAD:2,PATCH:3,OPTIONS:4,CONNECT:5,DELETE:6,TRACE:7,POST:8,PUT:9};e.exports=class t{constructor(){this.routes=[],this.all=this.add.bind(this,""),this.get=this.add.bind(this,"GET"),this.head=this.add.bind(this,"HEAD"),this.patch=this.add.bind(this,"PATCH"),this.options=this.add.bind(this,"OPTIONS"),this.connect=this.add.bind(this,"CONNECT"),this.delete=this.add.bind(this,"DELETE"),this.trace=this.add.bind(this,"TRACE"),this.post=this.add.bind(this,"POST"),this.put=this.add.bind(this,"PUT")}use(t,...e){let i=[].concat.apply([],e),{keys:n,pattern:a}=r(t,!0);return this.routes.push({keys:n,pattern:a,method:"",handlers:i,midx:s[""]}),this}add(t,e,...i){let{keys:n,pattern:a}=r(e),h=[].concat.apply([],i);return this.routes.push({keys:n,pattern:a,method:t,handlers:h,midx:s[t]}),this}find(t,e){let r=s[t],i=2===r,n=0,a=0,h,u,l=this.routes,o=[],d={},p=[];for(;n<l.length;n++)if((u=l[n]).midx===r||0===u.midx||i&&1===u.midx){if(!1===u.keys){if(null===(o=u.pattern.exec(e)))continue;if(void 0!==o.groups)for(h in o.groups)d[h]=o.groups[h];u.handlers.length>1?p=p.concat(u.handlers):p.push(u.handlers[0])}else if(u.keys.length>0){if(null===(o=u.pattern.exec(e)))continue;for(a=0;a<u.keys.length;)d[u.keys[a]]=o[++a];u.handlers.length>1?p=p.concat(u.handlers):p.push(u.handlers[0])}else u.pattern.test(e)&&(u.handlers.length>1?p=p.concat(u.handlers):p.push(u.handlers[0]))}return{params:d,handlers:p}}}}),require_build=__commonJS(t=>{var e=function(t){let e=t.url;if(null==e)return;let s=t._parsedUrl;if(s&&s.raw===e)return s;let i=e,n="",a;if(e.length>1){let h=e.indexOf("?",1);-1!==h&&(n=e.substring(h),i=e.substring(0,h),n.length>1&&(a=r.parse(n.substring(1))))}return t._parsedUrl={pathname:i,search:n,query:a,raw:e}},r=import.meta.require("querystring");t.parse=e}),require_build2=__commonJS((t,e)=>{var r=function(t,e,r){let i="number"==typeof t.status&&t.status;i=r.statusCode=i&&i>=100?i:500,"string"==typeof t||Buffer.isBuffer(t)?r.end(t):r.end(t.message||s.STATUS_CODES[i])},s=import.meta.require("http"),i=require_trouter(),{parse:n}=require_build(),a=t=>t instanceof h?t.attach:t;class h extends i{constructor(t={}){super(),this.parse=n,this.server=t.server,this.handler=this.handler.bind(this),this.onError=t.onError||r,this.onNoMatch=t.onNoMatch||this.onError.bind(null,{status:404}),this.attach=(t,e)=>setImmediate(this.handler,t,e)}use(t,...e){return"/"===t?super.use(t,e.map(a)):"function"==typeof t||t instanceof h?super.use("/",[t,...e].map(a)):super.use(t,(e,r,s)=>{if("string"==typeof t){let i=t.length;t.startsWith("/")||i++,e.url=e.url.substring(i)||"/",e.path=e.path.substring(i)||"/"}else e.url=e.url.replace(t,"")||"/",e.path=e.path.replace(t,"")||"/";"/"!==e.url.charAt(0)&&(e.url="/"+e.url),s()},e.map(a),(t,e,r)=>{t.path=t._parsedUrl.pathname,t.url=t.path+t._parsedUrl.search,r()}),this}listen(){return(this.server=this.server||s.createServer()).on("request",this.attach),this.server.listen.apply(this.server,arguments),this}handler(t,e,r){let s=this.parse(t),i=s.pathname,n=this.find(t.method,t.path=i);if(t.url=i+s.search,t.originalUrl=t.originalUrl||t.url,t.query=s.query||{},t.search=s.search,t.params=n.params,i.length>1&&-1!==i.indexOf("%",1))for(let a in t.params)try{t.params[a]=decodeURIComponent(t.params[a])}catch(h){}let u=0,l=n.handlers.concat(this.onNoMatch),o=l.length,d=async()=>e.finished||u<o&&l[u++](t,e,r);(r=r||(s=>s?this.onError(s,t,e,r):d().catch(r)))()}}e.exports=function(t){return new h(t)}});export default require_build2();